var $input;var currency_rate;$(document).ready(function () {	$.ajax({		cache: false,		type: 'POST',		data: {			'currency_name': "Euro"		},		url: getAppURL('currencies/get_currecny_rate_by_name'),		success: function (data) {			currency_rate = data;		}	});	$('#add_item_modal').on('click', function () {		document.getElementById("select_div").style.display = "none";		$("#itemsform").find('input:text').val('');		$("#description2_modal").val('');		$('#id_item_model').val('')		$("#iModalLabel").text('Add Item');		$('div#ItemFormModal').modal('show');	});	$('#edit_item_modal').on('click', function () {		document.getElementById("select_div").style.display = "block";		$("#itemsform").find('input:text').val('');		$("#description2_modal").val('');		$("#iModalLabel").text('Edit Item');		$('div#ItemFormModal').modal('show');	});	$('#generate').click(function (e) {		var barcode = $('#barcode').val();		e.preventDefault();		e.stopPropagation();		e.stopImmediatePropagation();		if (barcode == '') {			$.ajax({				cache: false,				type: 'POST',				data: {					'': ''				},				url: getAppURL('Items/fetchitemnumberfromDatabase'),				success: function (data) {					$('#barcode').val(data);				}			});		}	});	$('#save_item').on('click', function () {		$("#itemsform").each(function () {			$input = $(this).serializeArray();		});		// console.log($input);		// return false;		if ($('#id_item_model').val() == '') {			if (ItemModalvalidation() == true) {				// alert("done");				$.ajax({					cache: false,					type: 'POST',					data: { 'form_data': $input },					url: getAppURL('items/add_item_by_modal'),					success: function (data) {						// alert(data);						setTimeout(() => $('div#ItemFormModal').modal('hide'), 1000);						window.location.reload();					}				});			}		} else {			if (ItemModalvalidation() == true) {				$.ajax({					cache: false,					type: 'POST',					data: { 'form_data': $input },					url: getAppURL('items/edit_item_by_modal'),					success: function (data) {						// alert(data);						// if (data == "true") {						jQuery('tr', $transactionLines).each(function (i, tr) {							if (jQuery('input.i-item_id', tr).val() == $('#id_item_model').val()) {								// console.log()								let check = jQuery.inArray("order_purchases", $(location).attr('href').split("/"));								var currency_rate = $('#currency_rate').val();								var tva = $('#TVA1').val();								jQuery('input.i-item_cost', tr).val($('#cost_modal').val());								if (check !== -1) {									jQuery('input.i-cost', tr).val(0);									var price = parseFloat($('#cost_modal').val()) / parseFloat(currency_rate);									jQuery('input.i-price', tr).val(price.toFixed(2));								} else {									jQuery('input.i-cost', tr).val($('#cost_modal').val());									var price = ((parseFloat($('#cost_modal').val()) * (1 + (parseFloat(jQuery('input.i-item_profit', tr).val()) / 100))) * (1 + (parseFloat(tva) / 100))) / parseFloat(currency_rate);									jQuery('input.i-price', tr).val(price.toFixed(2));								}								let net_cost = (parseFloat(jQuery('input.i-price', tr).val()) * (1 - (jQuery('input.i-discount', tr).val() / 100)));								let total = jQuery('input.i-qty', tr).val() * net_cost;								let subtot = parseFloat(jQuery('input.i-price', tr).val()) * parseFloat(jQuery('input.i-qty', tr).val());								jQuery('td.i-total', tr).text(total.toFixed(2));								jQuery('td.i-subtotal', tr).text(subtot.toFixed(2));								calculateSubtotalAndTotal($('#disc'));							}						});						// }						setTimeout(() => $('div#ItemFormModal').modal('hide'), 1000);						window.location.reload();					}				});			}		}	});	$('#purchase_cost').on('change', function (e) {		if (isNaN(document.itemsform.purchase_cost.value) == false && document.itemsform.purchase_cost.value != '') {			document.getElementById('warning_purchase_cost').style.display = 'none';			var cost_chf = parseFloat($('#purchase_cost').val()) * parseFloat(currency_rate);			$('#cost_modal').val(cost_chf);			// if (document.itemsform.profit.value != '') {			// 	if (isNaN(document.itemsform.profit.value) == false) {			// 		$('#price').val(parseFloat($('#cost').val()) * (1 + (parseFloat($('#profit').val()) / 100)));			// 	}			// }		} else {			document.getElementById('warning_purchase_cost').style.display = 'block';			document.getElementById('warning_purchase_cost').innerHTML = "*it must be a numeric value*";			document.getElementById('warning_purchase_cost').className = "alert alert-warning";		}	});	$('#open_cost').on('change', function (e) {		if (isNaN(document.itemsform.open_cost.value) == false) {			document.getElementById('warning_open_cost').style.display = 'none';			var cost_chf = parseFloat($('#open_cost').val()) * parseFloat(currency_rate);			$('#cost_modal').val(cost_chf);			// if (document.itemsform.profit.value != '') {			// 	if (isNaN(document.itemsform.profit.value) == false) {			// 		document.getElementById('warning_open_cost').style.display = 'block';			// 		$('#price').val(parseFloat($('#cost').val()) * (1 + (parseFloat($('#profit').val()) / 100)));			// 	}			// }		} else {			document.getElementById('warning_open_cost').style.display = 'block';			document.getElementById('warning_open_cost').innerHTML = "*it must be a numeric value*";			document.getElementById('warning_open_cost').className = "alert alert-warning";		}	});	// $('#profit').on('change', function (e) {	// 	if (document.itemsform.cost.value != '') {	// 		if (document.itemsform.profit.value != '') {	// 			if (isNaN(document.itemsform.profit.value) == false) {	// 				$('#price').val(parseFloat($('#cost').val()) * (1 + (parseFloat($('#profit').val()) / 100)));	// 				document.getElementById('warning_profit').style.display = 'none';	// 			} else {	// 				document.getElementById('warning_profit').style.display = 'block';	// 				document.getElementById('warning_profit').innerHTML = "*it must be a numeric value*";	// 				document.getElementById('warning_profit').className = "alert alert-warning";	// 			}	// 		}	// 	}	// });	autoCompleteItemModelEdit();});function ItemModalvalidation() {	var count = 0;	// alert($('#id_item_model').val());	if ($('#id_item_model').val() === '') {		$.ajax({			cache: false,			type: 'POST',			data: { 'barcode': document.itemsform.barcode.value },			url: getAppURL('Items/check_if_barcode_exists'),			success: function (data) {				console.log(data);				if (data != "0") {					document.getElementById('error_barcode').innerHTML = "*Please Enter a new barcode: barcode must be unique*";					document.getElementById('error_barcode').className = "alert alert-danger";					count++;				}			}		});		$.ajax({			cache: false,			type: 'POST',			async: false,			data: { 'EAN': $('#EAN').val() },			url: getAppURL('Items/check_if_EAN_exists'),			success: function (data) {				if (data != "0") {					document.getElementById('error_EAN').innerHTML = "*Please Enter a new EAN: it must be unique*";					document.getElementById('error_EAN').className = "alert alert-danger";					count++;				}			}		});	} else {		$.ajax({			cache: false,			type: 'POST',			async: false,			data: { 'barcode': document.itemsform.barcode.value, 'id': $('#id_item_model').val() },			url: getAppURL('Items/check_if_barcode_exists_on_item_update'),			success: function (data) {				if (data.barcode != document.itemsform.barcode.value) {					if (data.count != "0") {						document.getElementById('error_barcode').innerHTML = "*Please Enter a new barcode: it must be unique*";						document.getElementById('error_barcode').className = "alert alert-danger";						count++;					}				}			}		});		$.ajax({			cache: false,			type: 'POST',			async: false,			data: { 'EAN': $('#EAN').val(), 'id': $('#id_item_model').val() },			url: getAppURL('Items/check_if_EAN_exists_on_item_update'),			success: function (data) {				if (data.item_EAN != $('#EAN').val()) {					if (data.count != "0") {						document.getElementById('error_EAN').innerHTML = "*Please Enter a new EAN: it must be unique*";						document.getElementById('error_EAN').className = "alert alert-danger";						count++;					}				}			}		});	}	var id = $('#id').val();	if (document.itemsform.barcode.value == "") {		document.getElementById('error_barcode').innerHTML = "*Please Enter or generate a Barcode*";		document.getElementById('error_barcode').className = "alert alert-danger";		count++;	}	if (document.itemsform.description.value == "") {		document.getElementById('error_description').innerHTML = "*Please enter a Name*";		document.getElementById('error_description').className = "alert alert-danger";		count++;	}	if (document.itemsform.EAN.value == "") {		document.getElementById('error_EAN').innerHTML = "*Please enter a EAN*";		document.getElementById('error_EAN').className = "alert alert-danger";		count++;	}	if (document.itemsform.artical_number.value == "") {		document.getElementById('error_artical_number').innerHTML = "*Please enter a Artical Number*";		document.getElementById('error_artical_number').className = "alert alert-danger";		count++;	}	if (isNaN(document.itemsform.cost_modal.value) == true) {		document.getElementById('error_cost').innerHTML = "*Please enter a numeric value*";		document.getElementById('error_cost').className = "alert alert-danger";		count++;	}	if (isNaN(document.itemsform.purchase_cost.value) == true) {		document.getElementById('error_purchase_cost').innerHTML = "*Please enter a numeric value*";		document.getElementById('error_purchase_cost').className = "alert alert-danger";		count++;	}	if (isNaN(document.itemsform.open_cost.value) == true) {		document.getElementById('error_open_cost').innerHTML = "*Please enter a numeric value*";		document.getElementById('error_open_cost').className = "alert alert-danger";		count++;	}	if (isNaN(document.itemsform.weight.value) == true) {		document.getElementById('error_weight').innerHTML = "*Please enter a numeric value*";		document.getElementById('error_weight').className = "alert alert-danger";		count++;	}	if (count > 0) {		return false;	} else {		return true;	}}function autoCompleteItemModelEdit() {	$('#select_edit_item').on('keydown', function (e) {		if (e.keyCode == 13) {			// do not submit form on press of return key			e.preventDefault();			e.stopPropagation();			e.stopImmediatePropagation();			return false;		}	}).autocomplete({		serviceUrl: getAppURL('items/lookup_items_by_EAN_and_artical_nb'), appendTo: $('#select_edit_item').parent()[0],		noCache: true, showNoSuggestionNotice: true, triggerSelectOnValidInput: false, minChars: 2, autoSelectFirst: true, preventBadQueries: false,		noSuggestionNotice: 'Sorry, no matching results', type: 'GET', dataType: 'JSON', deferRequestBy: 480,		onSearchStart: function (params) {		}, onSelect: function (result) {			// alert(result.row.id);			$('#id_item_model').val(result.row.id);			$('#barcode').val(result.row.barcode);			$('#description_modal').val(result.row.description);			$('#brand').val(result.row.brand);			$('#EAN').val(result.row.EAN);			$('#artical_number').val(result.row.artical_number);			$('#category').val(result.row.category);			$('#item_range').val(result.row.item_range);			$('#OE_nb').val(result.row.OE_nb);			$('#weight').val(result.row.weight);			$('#description2_modal').val(result.row.description2);			$('#open_cost').val(result.row.open_cost);			$('#open_qty').val(result.row.open_qty);			$('#cost_modal').val(result.row.cost);			$('#purchase_cost').val(result.row.purchase_cost);			$('#alternative').val(result.row.alternative);			if (result.row.qty_multiplier == '2') {				$("#qty_multiplier2").attr('checked', 'checked');			} else {				$("#qty_multiplier1").attr('checked', 'checked');			}		}, transformResult: function (response) {			return {				suggestions: jQuery.map(response, function (item) {					return { value: item.suggestion, row: item };				})			};		}	});}