jQuery(document).ready(function () {    window.salesDT = null;    let dtActionsHTML = '<a href="' + getAppURL('sales/edit/') + '%d" class="btn bt-link btn-sm" title="Edit"><i style="color:#282828;" class="fas fa-edit"></i></a>' +        '<a href="#" data-id="%d"\n' + '                                               data-action="sales/delete"\n' + '                                               class="btn bt-link btn-sm deleteBtn" title="Delete">\n' + '                                                <i class="fas fa-trash"></i>\n' + '                                            </a>' +        '<a href="' + getAppURL('sales/check/') + '%d" class="btn bt-link btn-sm" title="Edit"><i style="color:#282828;" class="fas fa-check-circle"></i></a>' +        '<a href="' + getAppURL('accounts/customer_info_preview/') + '%d" class="btn bt-link btn-sm" title="Customer Info"><i style="color:#282828;" class="fas fa-user" ></i></a>'        + '<a href="' + getAppURL('sales/view/') + '%d" class="btn bt-link btn-sm" title="View"><i style="color:#282828;" class="fas fa-info-circle" ></i></a>' +        '<a href="' + getAppURL('sales/invoice_print/') + '%d" class="btn bt-link btn-sm" title="Print"><i style="color:#282828;" class="fas fa-print" ></i></a>' +        '<a href="#" data-id="%d"\n' +        '                                               data-action="sales/return_pfand"\n' +        '                                               class="btn bt-link btn-sm returnPfandBtn" title="Return Pfand">\n' +        '                                                <i class="fas fa-undo"></i>\n' +        '                                            </a>';    let statusHTML = '<input name="status" type="checkbox"id="status" class="input.i-status" onclick="return changeStatusList();" %s>';    let deliveredHTML = '<input name="delivered" type="checkbox"id="delivered" class="input.i-delivered" onclick="return changeDeliveredList();" %s>';    /***************************************************/    var $dtTbl = $('#salesTbl');    BuildDataTableColumnSearch($dtTbl, 'salesDT');    EnhanceDataTableSearch(window.salesDT = $dtTbl.DataTable({        orderCellsTop: true, fixedHeader: { headerOffset: 0 }, searchDelay: _GST, lengthMenu: _dtLengthMenu,        serverSide: true, processing: true, scrollX: false, scrollY: false, deferLoading: $dtTbl.attr('data-num-rows'),        order: [[0, 'asc']], ajax: {            url: getAppURL('sales/index'), type: 'GET', searchDelay: _GST,            complete: function () {                check_paid_and_due_date();            }        },        initComplete: function () {            var api = this.api();            api.column(14).visible(false);        },        columns: [{ data: 'auto_no' }, { data: 'os_no' }, { data: 'qu_no' }, { data: 'trans_date' }, { data: 'account1' }, { data: 'model' }, { data: 'VIN' },        { data: 'OE' }, { data: 'description' }, { data: 'user_name' }, { data: 'total' }, { data: 'status' }, { data: 'delivered' }, { data: 'id' }, { data: 'value_date' }],        columnDefs: [            { targets: 13, orderable: false, createdCell: (td, accId) => $(td).addClass('text-right').html(dtActionsHTML.replace(/%d/g, parseInt(accId))) },            { targets: 12, orderable: false, createdCell: (td, delivered) => $(td).addClass('text-right').html(deliveredHTML.replace(/%s/g, delivered_check(delivered))) },            { targets: 11, orderable: false, createdCell: (td, status) => $(td).addClass('text-right').html(statusHTML.replace(/%s/g, status_check(status))) },            {targets: 3, render: $.fn.dataTable.render.moment('YYYY-MM-DD','DD-MM-YYYY')}            , {                defaultContent: "-", targets: "_all"            }        ],        /*pagingType: "input",*/        stateSave: true,        stateSaveCallback: function (settings, data) {            localStorage.setItem('DataTables_' + settings.sInstance, JSON.stringify(data))        },        stateLoadCallback: function (settings) {            return JSON.parse(localStorage.getItem('DataTables_' + settings.sInstance))        },        "stateSaveParams": function (settings, data) {            var temp = {};            $('#salesTbl thead').find("tr:eq(1)").find('input').each(function (n) {                $(this).attr('id', 'input_' + n);                temp[$(this).attr('placeholder')] = document.getElementById($(this).attr('id')).value;            });            data.colsFilter = temp;            // console.log(temp);        },        "stateLoadParams": function (settings, data) {            $.each(data.colsFilter, function (key, val) {                $('#salesTbl thead input[placeholder="' + key + '"]').val(val);            });        },        "stateLoaded": function (settings, data) {            $('#salesTbl').DataTable().ajax.reload();        }    }), 2048);    $('#reset_filters').on('click', function (e) {        location.reload();    });    // check_paid_and_due_date();    autoCompleteTrackingNb();});function status_check(status) {    if (parseInt(status) === 1) {        return 'checked';    } else {        return '';    }}function delivered_check(delivered) {    if (parseInt(delivered) === 1) {        return 'checked';    } else {        return '';    }}function check_paid_and_due_date() {    // $("#salesTbl tbody tr").each(function () {    // 	$paid = $(this).find("td:eq(9)").find('[type="checkbox"]').is(':checked')    // 	var data = $('#salesTbl').DataTable().row($(this)).data();    // 	if ($paid === false) {    // 		var today = new Date();    // 		var value_date = new Date(data['value_date']);    // 		if (today.getTime() > value_date.getTime()) {    // 			$(this).css('background-color', '#fbd2d0');    // 		}    // 	}    // });}function autoCompleteTrackingNb() {    $inpLkup = $('#select_tracking_nb');    $inpLkup.autocomplete({        serviceUrl: getAppURL('sales/lookup_tracking_nbs'),        appendTo: $inpLkup.parent()[0],        noCache: true,        showNoSuggestionNotice: true,        triggerSelectOnValidInput: false,        minChars: 2,        autoSelectFirst: true,        preventBadQueries: false,        noSuggestionNotice: 'Sorry, no matching results',        type: 'GET',        dataType: 'JSON',        deferRequestBy: 480,        onSearchStart: function (params) {        },        onSelect: function (result) {            let x = $('#multi_auto_no').val()            if (x == '') {                $('#multi_auto_no').val(result.row.auto_no)                $('#multi_text').text(result.row.auto_no)            } else {                $('#multi_auto_no').val(x + "," + result.row.auto_no)                $('#multi_text').text(x + "," + result.row.auto_no)            }            $('#select_tracking_nb').val('')            triggerDTFiltersSearch();        },        transformResult: function (response) {            return {                suggestions: jQuery.map(response, function (account) {                    return {value: account.description, row: account};                })            };        }    });}function getAllStatusTdCells() {    const table = document.getElementById('salesTbl');    const rows = table.getElementsByTagName('tr');    for (let i = 0; i < rows.length; i++) {        const cells = rows[i].getElementsByTagName('td');        if (cells[11]) {            const statusOnTable = cells[11].innerHTML;            const checkbox = document.createElement('input');            checkbox.type = 'checkbox';            checkbox.name = 'status';            checkbox.onclick = function () {                const itemId = cells[11].getAttribute('data-id');                if (parseInt(itemId)) {                    changeStatusList(itemId);                }            };            if (parseInt(statusOnTable) === 1) {                checkbox.checked = true;            } else if (parseInt(statusOnTable) === 0) {                checkbox.checked = false;            } else {                checkbox.checked = false;            }            cells[11].textContent = '';            cells[11].appendChild(checkbox);        } else {            console.log('not  found!');        }    }}function getAllDeliveredTdCells() {    const table = document.getElementById('salesTbl');    const rows = table.getElementsByTagName('tr');    for (let i = 0; i < rows.length; i++) {        const cells = rows[i].getElementsByTagName('td');        if (cells[12]) {            const deliveredOnTable = cells[12].innerHTML;            const checkbox = document.createElement('input');            checkbox.type = 'checkbox';            checkbox.name = 'delivered';            checkbox.onclick = function () {                const itemId = cells[12].getAttribute('data-id');                if (parseInt(itemId)) {                    changeDeliveredList(itemId);                }            };            if (parseInt(deliveredOnTable) === 1) {                checkbox.checked = true;            } else if (parseInt(deliveredOnTable) === 0) {                checkbox.checked = false;            } else {                checkbox.checked = false;            }            cells[12].textContent = '';            cells[12].appendChild(checkbox);        } else {            console.log('not  found!');        }    }}function changeStatusList() {    let table = $('#salesTbl').DataTable();    $('#salesTbl tbody').on('click', 'tr', function () {        let rowData = table.row(this).data();        var itemId = rowData.id;        $.ajax({            url: 'sales/change_status', type: 'POST', data: {itemId: itemId}, success: function (response) {                // Handle the response from the server                table.ajax.reload();                window.location.reload();            }        });    });}function changeDeliveredList() {    let table = $('#salesTbl').DataTable();    $('#salesTbl tbody').on('click', 'tr', function () {        let rowData = table.row(this).data();        var itemId = rowData.id;        $.ajax({            url: 'sales/change_delivered', type: 'POST', data: {itemId: itemId}, success: function (response) {                // Handle the response from the server                table.ajax.reload();                window.location.reload();            }        });    });}